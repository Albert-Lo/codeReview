var weatherApp = angular.module('weatherApp', []);

  //I should not have passed in scope only $http
  weatherApp.factory('getWeather', function($http, $q) {
  return {
    weatherLookup: function() {
      //var request = $http.get('http://api.openweathermap.org/data/2.5/weather?q=berkeley&APPID=a6ed7e23844c83dfb1d0a05d2861aa6f')
      //return request;
      return $http.get('http://api.openweathermap.org/data/2.5/weather?q=berkeley&APPID=a6ed7e23844c83dfb1d0a05d2861aa6f')
    }
  }
    /*
    weatherLookup: function() {
      console.log("This funtion was called")
      var deferred = $q.defer();
      var weatherData = {}
        $http.get('http://api.openweathermap.org/data/2.5/weather?q=berkeley&APPID=a6ed7e23844c83dfb1d0a05d2861aa6f')
          .success(function(data) {
            deferred.resolve({location: data.name,
                             status: data.clouds.main,
                             temp: data.main.temp});
          }).error(function(msg, code) {
            deferred.reject(message);
            $log.error(msg, code);
          });
          return deferred.promise
      }
      */
    });

  weatherApp.controller('WeatherCtrl', function($scope, $rootScope ,$http, getWeather) {
    $scope.weatherInfo = "Hello"
    console.log("The controller is being called here")
    getWeather.weatherLookup().success(function(weatherData){
      console.log(weatherData)
      $scope.weatherInfo = weatherData;
      $rootScope.temp = weatherData.main.temp;
      $rootScope.location = weatherData.name;
      $rootScope.status = weatherData.weather[0].description;
      $rootScope.icon = weatherData.weather[0].icon;
      $rootScope.id = weatherData.weather[0].id;
    })
    /*
    $scope.weatherData = function() {
      getWeather.weatherLookup()
        .then(function(weatherData) {
          console.log("Here is the weather data")
          console.log (weaterData)
         // $scope.weaterData = weaterData;
         // console.log("Here is the scope weatherData")
         // console.log($scope.weaterData)
          //$rootScope.temp = 
          //$rootScope.location = 
          //$rootScope.status = 
       });
    };
    */
    $rootScope.display = "Here I am"

  });

  weatherApp.directive('weatherIcon', function() {
    //Directive to Generate Images for the App
    return {
      //Pre-Information
      restrict: 'E', 
      replace: true,
      scope: {
        overcast: '@',
        rain: '@'
      },
      controller: function($scope, $rootScope) {
        $scope.icon = function() {
          this.weatherData = "How are you"
          this.weatherStatus = "Hi"
          var baseUrl = 'http://openweathermap.org/img/w/';
          console.log($rootScope.icon)
          return baseUrl + $rootScope.icon + ".png"

        }
      },
      template: '<img ng-src="{{ icon() }}">'
    };
  });
